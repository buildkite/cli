version: '3.5'

services:
  golangci-lint:
    image: golangci/golangci-lint:v1.54.1
    working_dir: /app
    volumes:
      - ..:/app
      - ~/.cache/golangci-lint/v1.54.1:/root/.cache
  build:
    image: goreleaser/goreleaser:v1.20.0
    working_dir: /go/src/github.com/buildkite/cli
    volumes:
      - ..:/go/src/github.com/buildkite/cli
    command:
      - build
      - --snapshot
      - --clean
  release:
    image: goreleaser/goreleaser:v1.20.0
    working_dir: /go/src/github.com/buildkite/cli
    volumes:
      - ..:/go/src/github.com/buildkite/cli
    environment:
      - GITHUB_TOKEN
    command:
      - release
      - --clean
